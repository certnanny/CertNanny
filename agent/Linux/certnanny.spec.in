#
# CertNanny spec file
#

Name:         certnanny
License:      GPL
Group:        Productivity/Security
Autoreqprov:  on
Summary:      Certificate renewal agent
Version:      VERSIONINFO
Release:      1
Source:       %{name}-%{version}.tar.gz
URL:          http://www.cynops.de/oss/CertNanny/
BuildRoot:    %{_tmppath}/%{name}-build
Requires:     openssl, sscep

%description
CertNanny is a client-side program that allows fully automatic
renewal of certificates. The basic idea is to have a number of local
keystores that are monitored for expiring certificates. If a certificate
is about to expire, the program automatically creates a new certificate
request with the existing certificate data, enrolls the request with the
configured CA and polls the CA for the issued certificate. Once the
certificate is ready, a new keystore with the new certificate is composed
and replaces the old keystore. 


%prep
%setup -n %{name}-%{version}

%build
make

%install
mkdir -p $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT/usr/lib/perl5/site_perl/
#tar -C lib/perl -c -f - . | tar -C $RPM_BUILD_ROOT/usr/lib/perl5/site_perl/ -x -v -f -
tar -C lib/perl -c -f - --exclude=DAEMON.PM --exclude=daemon.DLL . | tar -C $RPM_BUILD_ROOT/usr/lib/perl5/site_perl/ -x -v -f -
mkdir -p $RPM_BUILD_ROOT/var/CertNanny/state
mkdir -p $RPM_BUILD_ROOT/var/CertNanny/AutoritativeRootcerts
mkdir -p $RPM_BUILD_ROOT/var/CertNanny/etc
mkdir -p $RPM_BUILD_ROOT/var/CertNanny/logs
mkdir -p $RPM_BUILD_ROOT/var/CertNanny/quarantine
mkdir -p $RPM_BUILD_ROOT/var/CertNanny/tmp
install -D -m 755 bin/certnanny $RPM_BUILD_ROOT/opt/CertNanny/bin/certnanny
install -D -m 644 certnanny.1.gz $RPM_BUILD_ROOT/usr/share/man/man1/certnanny.1.gz
install -D -m 644 lib/java/ExtractKey.jar $RPM_BUILD_ROOT/opt/CertNanny/lib/certnanny/java/ExtractKey.jar
install -D -m 644 etc/certnanny.cfg $RPM_BUILD_ROOT/var/CertNanny/etc/certnanny.cfg
install -D -m 644 etc/Keystore-Java.cfg $RPM_BUILD_ROOT/var/CertNanny/etc/Keystore-Java.cfg
install -D -m 644 etc/Keystore-PKCS12.cfg $RPM_BUILD_ROOT/var/CertNanny/etc/Keystore-PKCS12.cfg
install -D -m 644 etc/certreq.inf $RPM_BUILD_ROOT/var/CertNanny/etc/certreq.inf
install -D -m 644 etc/Keystore-MQ.cfg $RPM_BUILD_ROOT/var/CertNanny/etc/Keystore-MQ.cfg
install -D -m 644 etc/Keystore-OpenSSL.cfg $RPM_BUILD_ROOT/var/CertNanny/etc/Keystore-OpenSSL.cfg
install -D -m 644 etc/Keystore-DEFAULT.cfg $RPM_BUILD_ROOT/var/CertNanny/etc/Keystore-DEFAULT.cfg
install -D -m 644 etc/Keystore-Windows.cfg $RPM_BUILD_ROOT/var/CertNanny/etc/Keystore-Windows.cfg
install -D -m 644 etc/Keystore-OpenSSL-PKCS8.cfg $RPM_BUILD_ROOT/var/CertNanny/etc/Keystore-OpenSSL-PKCS8.cfg
install -D -m 644 etc/certnanny-Master.cfg $RPM_BUILD_ROOT/var/CertNanny/etc/certnanny-Master.cfg

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
%doc README INSTALL QUICKSTART FAQ LICENSE ChangeLog
%config /var/CertNanny/etc/certnanny.cfg

/opt/CertNanny/bin/certnanny
/usr/share/man/man1/certnanny.1.gz
/opt/CertNanny/lib/certnanny/java/ExtractKey.jar
/usr/lib/perl5/site_perl/CertNanny.pm
/usr/lib/perl5/site_perl/CertNanny
/var/CertNanny/etc/Keystore-Java.cfg
/var/CertNanny/etc/Keystore-PKCS12.cfg
/var/CertNanny/etc/certreq.inf
/var/CertNanny/etc/Keystore-MQ.cfg
/var/CertNanny/etc/Keystore-OpenSSL.cfg
/var/CertNanny/etc/Keystore-DEFAULT.cfg
/var/CertNanny/etc/Keystore-Windows.cfg
/var/CertNanny/etc/Keystore-OpenSSL-PKCS8.cfg
/var/CertNanny/etc/certnanny-Master.cfg
%dir /var/CertNanny/AutoritativeRootcerts 
%dir /var/CertNanny/etc
%dir /var/CertNanny/logs 
%dir /var/CertNanny/quarantine 
%dir /var/CertNanny/state 
%dir /var/CertNanny/tmp

